% To pass options to packages loaded from class file, these commands sust be called before the
% \documentclass command.

% Capitalize references when using \cref.
\PassOptionsToPackage{capitalise}{cleveref}

% Add support for inline lists with enumitem package. 
\PassOptionsToPackage{inline}{enumitem}

% Suppress vertical gap between glossary groups (entries are grouped by their first letter).
% \PassOptionsToPackage{nogroupskip}{glossaries}

% Remove dot after entry description in glossary. 
\PassOptionsToPackage{nopostdot}{glossaries}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[
    % print,
    % draft,
    % nativefonts,
]{dissertation}

% For Japanese font.
\usepackage{xeCJK}

% Units formatted using siunitx.
\usepackage{siunitx}
\sisetup{
    group-separator={\ },
    per-mode=symbol,
}

% Math stuff
\usepackage{amsmath}

% Braket notation.
\usepackage{braket}

% Theorems with amsthm (need to undefine \openbox to avoid re-definition error).
\let\openbox\relax
\usepackage{amsthm}

% Index-style glossary. 
\usepackage{glossary-mcols}

% To include PDF pages directly.
\usepackage{pdfpages}

% For abbreviations
\usepackage[nolist,printonlyused]{acronym}

% To generate dummy (placeholder) text.
\usepackage{lipsum}

% For code listings.
\usepackage{listings}

% Bibliography managed using BibLaTeX.
\usepackage[
    giveninits=true,     % only given name initials and not the full given name
    maxnames=50,         % max authors in bibliography
    maxcitenames=2,      % max authors when citing
    sortcites=true,      % sort citations in multi-cite commands
    urldate=long,        % explicit URL date
    backend=biber,       % biber backend
    refsection=chapter,  % start a reference section at every \chapter command
]{biblatex}
\addbibresource{references/articles.bib}
\addbibresource{references/arxiv.bib}
\addbibresource{references/misc.bib}
\addbibresource{references/online.bib}
\addbibresource{references/proceedings.bib}
\addbibresource{references/netqasm.bib}
\addbibresource{references/qoala.bib}
\addbibresource{references/qnodeos.bib}
\addbibresource{references/compiler.bib}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define bibliography entries that won't be included in list of references.
\DeclareBibliographyCategory{noprint}
\addtocategory{noprint}{dahlberg_2022_netqasm_noprint}
\addtocategory{noprint}{delledonne_2023_qnodeos_noprint}
\addtocategory{noprint}{donne_design_2024_noprint}
\addtocategory{noprint}{pompili_2022_experimental_noprint}
\addtocategory{noprint}{qoala_noprint}

% Make name of author bold if bibliography entry has "makebf" annotation for that author.
\renewcommand*{\mkbibnamegiven}[1]{\ifitemannotation{makebf}{\textbf{#1}}{#1}}
\renewcommand*{\mkbibnamefamily}[1]{\ifitemannotation{makebf}{\textbf{#1}}{#1}}

% Not sure why this is defined.
\newcommand{\sparkline}[1]{$\vcenter{\hbox{\includegraphics[scale=0.04]{#1}}}$}

% Not sure why this is defined.
\newcommand*{\origrightarrow}{}
\let\oldarrow\textrightarrow
\renewcommand*{\textrightarrow}{\fontfamily{cmr}\selectfont\origrightarrow}

% Custom command: \note{description}
\newcommand{\note}[1]{{\color{red}[\textbf{NOTE:} #1]}}

% Small caps for lettrine word.
\renewcommand*{\LettrineTextFont}{\scshape}

% The default reference string "EFTZ" causes issues when one of the capitals in a chapter is "T".
\renewcommand*{\LettrineTestString}{EFZ}

% Shortcut for writing |psi><psi|
\newcommand{\proj}[1]{\ket{#1}\bra{#1}}

% Custom hyphenation.
\hyphenation{ADwin}    % Do not hyphenate ADwin
\hyphenation{QNodeOS}  % Do not hyphenate QNodeOS
\hyphenation{QDevice}  % Do not hyphenate QDevice

% Define acronyms.
% Notice the use of \makenoidxglossary instead of \makeglossary to avoid running external tools
% (https://github.com/tectonic-typesetting/tectonic/issues/704).
\makenoidxglossaries
\loadglsentries[main]{glossary}

% Customize style of glossary. 
\setglossarystyle{mcolindex}
\setlength\columnsep{1cm}
\renewcommand*{\glstreeitem}{\par\raggedright}
\renewcommand*{\glsgroupskip}{\medskip}
\renewcommand*{\glsnamefont}[1]{\textbf{#1}}

% Show section numbers next to PDF outline bookmarks.
\hypersetup{bookmarksnumbered=true}

% Disable hyperlinks from acronyms to glossary entries.
\glsdisablehyper

% Set default style for lists. 
\setlist[enumerate,itemize]{
    topsep=1ex,
    itemsep=1ex,
    parsep=0ex,
    partopsep=0ex,
    leftmargin=*,
}

% Define style of inline lists.
\newlist{inlinelist}{enumerate*}{1}
\setlist[inlinelist]{label=(\arabic*)}

% Define new type of table column.
\newcolumntype{Y}{>{\raggedleft\arraybackslash}X}

% Define custom theorem environment for examples.
\theoremstyle{definition}
\newtheorem{example}{Example}[section]

% Redefine \paragraph command to reduce vertical and horizontal spacing and to add a period after
% the heading. References:
% - https://tex.stackexchange.com/questions/40943/new-line-and-no-indent-after-paragraph
% - https://tex.stackexchange.com/questions/328355/add-a-period-after-each-paragraph-title
\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
    {1ex \@plus 1ex \@minus 0.2ex}%
    {-0.5em}%
    {\normalfont\normalsize\bfseries\maybe@addperiod}%
}
\newcommand{\maybe@addperiod}[1]{%
    #1\@addpunct{.}%
}
\makeatother

% Increase maximum stretch for a certain paragraph (https://tex.stackexchange.com/q/84510), mostly
% to be used to avoid overflow in list of references.
\newenvironment{xstretch}{\par\emergencystretch=1em}{\par}

% Turn off crop marks even in print builds, as the printing company does not need them.
\renewcommand*\cropmarks{}

\lstset{
  language=Python,
  basicstyle=\ttfamily\small,
  numbers=left,
  numberstyle=\tiny\color{gray},
  stepnumber=1,
  numbersep=5pt,
  backgroundcolor=\color{white},
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  frame=single,
  rulecolor=\color{black},
  tabsize=2,
  captionpos=b,
  breaklines=true,
  breakatwhitespace=false,
  title=\lstname,
  keywordstyle=\color{blue},
  commentstyle=\color{codegreen},
  stringstyle=\color{red},
  escapeinside={\%*}{*)},
  morekeywords={*,...}
}


% Syntax highlighting
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    % backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    firstnumber=0,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}
\lstdefinestyle{inlinestyle}{
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    % basicstyle=\ttfamily\footnotesize\color{CadetBlue},
    basicstyle=\ttfamily\footnotesize\color{PineGreen},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    firstnumber=0,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}
\lstdefinelanguage{netqasm}
{
    morekeywords={
        add, add, sub, addm, subm,
        jmp, bez, bnz, beq, bne, blt, bge,
        set, store, load, undef, lea,
        array, qalloc, qfree,
        wait_all, wait_any, wait_single,
        ret_reg, ret_arr,
        meas,
        create_epr, recv_epr,
        init, x, y, z, h, s, k, t, rot_x, rot_y, rot_z, cnot, cphase, cx_dir, cy_dir,
        APPID, NETQASM,
    }
    sensitive=false,
    morecomment=[l]{//},
    morecomment=[s]{/*}{*/},
    morecomment=[s][\color{blue}]{\#\ }{\ },
    % morecomment=[s][\color{yellow}]{LOOP}{:},
    morestring=[b]",
}

\lstnewenvironment{nqcode}{\lstset{style=mystyle,language=netqasm}}{}
\lstnewenvironment{pycode}{\lstset{style=mystyle,language=Python}}{}
\newcommand{\nq}[1]{\lstinline[style=inlinestyle,language=C++]{#1}}
\newcommand{\py}[1]{\lstinline[language=Python]{#1}}

\newcommand{\todo}[1]{\textcolor{red}{TODO #1}}
\newcommand{\reminder}[1]{\textcolor{blue}{#1}}



\acrodef{AE}{Atomic Ensembles}
\acrodef{API}{Application Programming Interface}
\acrodef{ASIC}{Application-Specific Integrated Circuit}
\acrodef{CNPU}{Classical Network Processing Unit}
\acrodef{CPLD}{Complex Programmable Logic Device}
\acrodef{CPU}{Central Processing Unit}
\acrodef{CQC}{Classical Quantum Combiner}
\acrodef{CR}{Charge-Resonance}
\acrodef{DD}{Dynamical Decoupling}
\acrodef{DQC}{Delegated Quantum Computation}
\acrodef{DQP}{Distributed Queue Protocol}
\acrodef{EGP}{Entanglement Generation Protocol}
\acrodef{EMU}{Entanglement Management Unit}
\acrodef{EPR}{Entanglement Pair Request}
\acrodef{ER}{Entanglement Request}
\acrodef{FPGA}{Field Programmable Gate Array}
\acrodef{HAL}{Hardware Abstraction Layer}
\acrodef{IPC}{Inter-Process Communication}
\acrodef{IT}{Ion Traps}
\acrodef{LGT}{Local Gate Tomography}
\acrodef{MW}{Microwave}
\acrodef{NetQASM}{Quantum Network Assembly Language}
\acrodef{NISQ}{Noisy Intermediate-Scale Quantum} 
\acrodef{NV}{Nitrogen Vacancy} 
\acrodef{OS}{Operating System}
\acrodef{OSI}{Open Systems Interconnect}
\acrodef{QASM}{Quantum Assembly Language}
\acrodef{QDevice}{Quantum Device}
\acrodef{QDriver}{QDevice Driver}
\acrodef{QEGP}{Quantum Entanglement Generation Protocol}
\acrodef{QMMU}{Quantum Memory Management Unit}
\acrodef{QNetStack}{Quantum Network Stack}
\acrodef{QNodeOS}{Quantum Network Operating System}
\acrodef{QNP}{Quantum Network Protocol}
\acrodef{QNPU}{Quantum Network Processing Unit}
\acrodef{QPU}{Quantum Processing Unit}
\acrodef{PID}{Proportional–Integral–Derivative}
\acrodef{PSB}{Phonon-Side Band}
\acrodef{PMT}{Photomultiplier Tube}
\acrodef{RO}{Readout}
\acrodef{SDK}{Software Development Kit}
\acrodef{SoC}{System on a Chip}
\acrodef{SP}{Spinpump}
\acrodef{SPI}{Serial Peripheral Interface}
\acrodef{SSRO}{Single-Shot Readout}
\acrodef{TTL}{Transistor-Transistor Logic}
\acrodef{ZPL}{Zero-Phonon Line}



\newcommand{\IMMEDIATE}{\textbf{IMMEDIATE}}
\newcommand{\REGISTER}{\textbf{REGISTER}}
\newcommand{\ADDRESS}{\textbf{ADDRESS}}
\newcommand{\ARRAYENTRY}{\textbf{ARRAY\_ENTRY}}
\newcommand{\ARRAYSLICE}{\textbf{ARRAY\_SLICE}}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

% Add front cover for non-print builds
% \makeatletter
% \unless\if@print
% \includepdf[pages=-]{cover/cover-front.pdf}
% \fi
% \makeatother

% Specify the title and author of the thesis. This information will be used on the title page (in
% chapters/meta/title.tex) and in the metadata of the final PDF.
% \title{Compilation and execution of programs on quantum network nodes}
% \title{A framework for application execution on programmable quantum network nodes}
\title{Programming and executing applications on quantum network nodes}
\author{Bart}{van der Vecht}

% Use Roman numerals for the page numbers of the title pages and table of contents.
\frontmatter

\include{chapters/meta/title}

% The (optional) dedication can be used to thank someone or display a significant quotation.
\dedication{\epigraph{
    TBD - some inspiring text
}{Author}}

\tableofcontents

\graphicspath{{figures/}{chapters/main/qnodeos/main/}}
\include{chapters/meta/summary}
\include{chapters/meta/samenvatting}
\include{chapters/meta/acks}
\include{chapters/meta/cv}
\include{chapters/meta/publications}

% Use Arabic numerals for the page numbers of the chapters.
\mainmatter

% Turn on thumb indices.
\thumbtrue

\include{chapters/main/intro}
% \include{chapters/main/background}
% \include{chapters/main/netqasm}
% \include{chapters/main/qnodeos}
% \include{chapters/main/qoala}
% \include{chapters/main/compiler}
% \include{chapters/main/conclusion}

% Use letters for the chapter numbers of the appendices.
\appendix

% \include{chapters/appendix/netqasm}
% \include{chapters/appendix/qoala}

% Turn off thumb indices for unnumbered chapters.
\thumbfalse

% Print glossary.
% Notice the use of \printnoidxglossary instead of \printglossary to avoid running external tools
% (https://github.com/tectonic-typesetting/tectonic/issues/704).
\glsaddall
\printnoidxglossary[type=\acronymtype,title={Glossary}]
\addcontentsline{toc}{chapter}{Glossary}
\setheader{Glossary}

% Add back cover for non-print builds
% \makeatletter
% \unless\if@print
% \includepdf[pages=-]{cover/cover-back.pdf}
% \fi
% \makeatother

\end{document}
